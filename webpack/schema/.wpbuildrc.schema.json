{
    "$schema": "http://json-schema.org/draft-07/schema#",
    "description": "WpBuild configuration file schema",
    "title": "WpBuildRcSchema",
    "type": "object",
    "properties": {
        "$schema": {
            "type": "string",
            "pattern": "^(?:file(?:.*?)[\\/\\\\]|https\\:\\/\\/app1\\.spmeesseman\\.com\\/res\\/app\\/wpbuild\\/v[0-9]+\\.[0-9]+\\.[0-9]+(?:\\-pre\\.[0-9]{1,2})?)\\/\\.wpbuildrc\\.schema\\.json$"
        },
        "name": {
            "type": "string",
            "minLength": 3
        },
        "displayName": {
            "type": "string",
            "minLength": 3
        },
        "detailedDisplayName": {
            "type": "string",
            "minLength": 10
        },
        "publicInfoProject": {
            "type": "boolean",
            "default": false
        },
        "singleBuildName": {
            "type": "string",
            "minLength": 2,
            "maxLength": 30,
            "readOnly": true
        },
        "source": {
            "$ref": "#/definitions/WpBuildRcSourceCodeType"
        },
        "builds": {
            "$ref": "#/definitions/WpBuildRcBuilds"
        },
        "development": {
            "$ref": "#/definitions/WpBuildRcEnvironment"
        },
        "log": {
            "$ref": "#/definitions/WpBuildRcLog"
        },
        "alias": {
            "$ref": "#/definitions/WpBuildWebpackAliasConfig"
        },
        "paths": {
            "$ref": "#/definitions/WpBuildRcPaths"
        },
        "exports": {
            "$ref": "#/definitions/WpBuildRcExports"
        },
        "plugins": {
            "$ref": "#/definitions/WpBuildRcPlugins"
        },
        "production": {
            "$ref": "#/definitions/WpBuildRcEnvironment"
        },
        "test": {
            "$ref": "#/definitions/WpBuildRcEnvironment"
        },
        "vscode": {
            "type": "object",
            "title": "WpBuildRcVsCode",
            "properties": {
                "extension": {
                    "type": "boolean",
                    "default": false
                },
                "languageServer": {
                    "type": "boolean",
                    "default": false
                }
            },
            "additionalProperties": false,
            "examples": [{
                "vscode": {
                    "testsEntry": "./src/test/runTests.js"
                }
            }]
        }
    },
    "additionalProperties": false,
    "required": [
        "name"
    ],
    "definitions":
    {
        "DirectoryPathRelative": {
            "type": "string",
            "maxLength": 100,
            "pattern": "^(?:\\.{1,2}[\\\\\\/][\\w\\.\\-\\\\\\/]+|\\.\\.?)$",
            "if": {
                "pattern": "^\\.$"
            },
            "then": {
                "minLength": 1
            },
            "else": {
                "minLength": 3
            }
        },
        "DirectoryPath": {
            "type": "string",
            "default": "src",
            "maxLength": 150,
            "pattern": "^(?:\\.{1,2}|(?:\\.[\\\\\\/])?[\\w][~@!\\w\\.\\-\\\\\\/]+)$",
            "if": {
                "pattern": "^\\.$"
            },
            "then": {
                "minLength": 1
            },
            "else": {
                "minLength": 3
            }
        },
        "DirectoryPathGlob": {
            "$ref": "#/definitions/DirectoryPath",
            "minLength": 4,
            "pattern": "^(?:\\.{1,2}[\\\\\\/])\\*{0,2}(?:\\.|(?:\\.[\\\\\\/])?[\\w][~@!\\w\\.\\-\\\\\\/]+)\\*{0,2}$",
            "if": {
                "pattern": "^\\.{1,2}[\\\\\\/]"
            },
            "then": {
                "if": {
                    "pattern": "^\\.\\.[\\\\\\/]\\*{0,2}\\"
                },
                "then": {
                    "minLength": 4
                },
                "else": {
                    "minLength": 3
                }
            },
            "else": {
                "minLength": 1
            }
        },
        "FileName": {
            "type": "string",
            "minLength": 3,
            "maxLength": 150,
            "pattern": "^[\\w\\.\\-]+\\.([cm]?jsx?|tsx?)$"
        },
        "FilePathRelative": {
            "type": "string",
            "minLength": 5,
            "maxLength": 150,
            "pattern": "^\\.[\\\\\\/][\\w\\.\\-\\\\\\/]+\\.([cm]?jsx?|tsx?)$"
        },
        "FilePathRelativeLeadingDot": {
            "type": "string",
            "minLength": 6,
            "maxLength": 150,
            "pattern": "^\\.{1,2}[\\\\\\/][\\w\\.\\-\\\\\\/]+?\\.\\w+$"
        },
        "WpBuildRcEnvironment": {
            "type": "object",
            "additionalProperties": false,
            "properties": {
                "alias": {
                    "$ref": "#/definitions/WpBuildWebpackAliasConfig"
                },
                "builds": {
                    "$ref": "#/definitions/WpBuildRcBuilds"
                },
                "log": {
                    "$ref": "#/definitions/WpBuildRcLog"
                },
                "paths": {
                    "$ref": "#/definitions/WpBuildRcPaths"
                },
                "exports": {
                    "$ref": "#/definitions/WpBuildRcExports"
                },
                "plugins": {
                    "$ref": "#/definitions/WpBuildRcPlugins"
                }
            }
        },
        "WpBuildRcBuilds": {
            "type": "array",
            "uniqueItems": true,
            "minItems": 0,
            "items": {
                "$ref": "#/definitions/WpBuildRcBuild"
            }
        },
        "WpBuildRcBuild": {
            "type": "object",
            "additionalProperties": false,
            "properties": {
                "name": {
                    "type": "string",
                    "minLength": 3,
                    "maxLength": 30
                },
                "build": {
                    "type": "string",
                    "minLength": 3,
                    "maxLength": 30
                },
                "debug": {
                    "type": "boolean",
                    "if": {
                        "properties": {
                            "debug": {
                                "const": true
                            }
                        }
                    },
                    "then": {
                        "properties": {
                            "type": {
                                "const": "module"
                            }
                        }
                    }
                },
                "source": {
                    "$ref": "#/definitions/WpBuildRcSourceCodeType"
                },
                "type": {
                    "$ref": "#/definitions/WpBuildRcBuildType"
                },
                "entry": {
                    "$ref": "#/definitions/WpBuildWebpackEntry"
                },
                "mode": {
                    "$ref": "#/definitions/WpBuildWebpackMode"
                },
                "target": {
                    "$ref": "#/definitions/WebpackTarget"
                },
                "alias": {
                    "$ref": "#/definitions/WpBuildWebpackAliasConfig"
                },
                "log": {
                    "$ref": "#/definitions/WpBuildRcLog"
                },
                "paths": {
                    "$ref": "#/definitions/WpBuildRcPaths"
                },
                "exports": {
                    "$ref": "#/definitions/WpBuildRcExports"
                },
                "plugins": {
                    "$ref": "#/definitions/WpBuildRcPlugins"
                }
            },
            "if": {
                "properties": {
                    "type": { 
                        "oneOf": [
                            { "const": "webapp"},
                            { "const": "webmodule"}
                        ]
                    }
                }
            },
            "then": { 
                "properties": {
                    "target": { 
                        "oneOf": [
                            { "const": "web"},
                            { "const": "webworker"}
                        ]
                    }
                }
            },
            "required": [
                "name"
            ]
        },
        "WpBuildRcBuildType": {
            "type": "string",
            "oneOf": [
                {
                    "const": "module"
                },
                {
                    "const": "tests"
                },
                {
                    "const": "types"
                },
                {
                    "const": "webapp"
                },
                {
                    "const": "webmodule"
                }
            ]
        },
        "WpBuildRcExports": {
            "type": "object",
            "additionalProperties": false,
            "properties": {
                "cache": {
                    "type": "boolean"
                },
                "devtool": {
                    "type": "boolean"
                },
                "experiments": {
                    "type": "boolean"
                },
                "externals": {
                    "type": "boolean"
                },
                "ignorewarnings": {
                    "type": "boolean"
                },
                "minification": {
                    "type": "boolean"
                },
                "optimization": {
                    "type": "boolean"
                },
                "watch": {
                    "type": "boolean"
                }
            }
        },
        "WpBuildRcLog": {
            "type": "object",
            "properties": {
                "color": {
                    "$ref": "#/definitions/WpBuildLogTrueColor"
                },
                "colors": {
                    "type": "object",
                    "title": "WpBuildRcLogColors",
                    "properties": {
                        "default": {
                            "$ref": "#/definitions/WpBuildLogTrueColor"
                        },
                        "buildBracket": {
                            "$ref": "#/definitions/WpBuildLogTrueColor"
                        },
                        "buildText": {
                            "$ref": "#/definitions/WpBuildLogTrueColor"
                        },
                        "infoIcon": {
                            "$ref": "#/definitions/WpBuildLogTrueColor"
                        },
                        "valueStar": {
                            "$ref": "#/definitions/WpBuildLogTrueColor"
                        },
                        "valueStarText": {
                            "$ref": "#/definitions/WpBuildLogTrueColor"
                        },
                        "tagBracket": {
                            "$ref": "#/definitions/WpBuildLogTrueColor"
                        },
                        "tagText": {
                            "$ref": "#/definitions/WpBuildLogTrueColor"
                        },
                        "uploadSymbol": {
                            "$ref": "#/definitions/WpBuildLogTrueColor"
                        }
                    },
                    "additionalProperties": false,
                    "required": []
                },
                "envTag1": {
                    "type": "string",
                    "default": "wpbuild",
                    "minimum": 2,
                    "maxLength": 15
                },
                "envTag2": {
                    "type": "string",
                    "default": "info",
                    "minimum": 2,
                    "maxLength": 15
                },
                "envTagDisable": {
                    "type": "boolean",
                    "default": false,
                    "readOnly": true
                },
                "level": {
                    "type": "number",
                    "title": "WpBuildLogLevel",
                    "oneOf": [
                        {
                            "const": 0,
                            "description": "No logging"
                        },
                        {
                            "const": 1,
                            "description": "Logging level 1 - Errors, warnings, and function start/end"
                        },
                        {
                            "const": 2,
                            "description": "Logging level 2 - Level 1 + parameter values"
                        },
                        {
                            "const": 3,
                            "description": "Logging level 3 - Level 2 + non-looping processing detail"
                        },
                        {
                            "const": 4,
                            "description": "Logging level 4 - Level 3 + looping processing detail"
                        },
                        {
                            "const": 5,
                            "description": "Logging level 5 - Verbose"
                        }
                    ],
                    "additionalProperties": false
                },
                "pad": {
                    "type": "object",
                    "title": "WpBuildRcLogPad",
                    "properties": {
                        "base": {
                            "type": "number",
                            "default": 0
                        },
                        "envTag": {
                            "type": "number",
                            "default": 25
                        },
                        "value": {
                            "type": "number",
                            "default": 45
                        },
                        "uploadFileName": {
                            "type": "number",
                            "default": 50
                        }
                    },
                    "additionalProperties": false,
                    "required": []
                },
                "timestamp": {
                    "type": "string",
                    "default": "hh:mm:ss:sss",
                    "oneOf": [
                        {
                            "const": "mm:ss"
                        },
                        {
                            "const": "mm:ss:sss"
                        },
                        {
                            "const": "hh:mm:ss"
                        },
                        {
                            "const": "hh:mm:ss:sss"
                        }
                    ],
                    "additionalProperties": false
                },
                "valueMaxLineLength": {
                    "type": "number",
                    "default": 100,
                    "minValue": 50,
                    "maxValue": 200
                }
            },
            "additionalProperties": false
        },
        "WpBuildRcPaths": {
            "type": "object",
            "properties": {
                "base": {
                    "$ref": "#/definitions/DirectoryPath",
                    "default": ".",
                    "readOnly": true,
                    "description": "Path to the base project directory, a full path containing project's package.json"
                },
                "ctx": {
                    "$ref": "#/definitions/DirectoryPath",
                    "default": ".",
                    "description": "Path to the base context directory as defined by Webpack, full path or relative to the project directory containing package.json"
                },
                "dist": {
                    "type": "string",
                    "default": "dist",
                    "description": "Path to the distribution / output directory, full path or relative to the project directory containing package.json"
                },
                "src": {
                    "$ref": "#/definitions/DirectoryPath",
                    "default": "src",
                    "description": "Path to the base source directory, full path or relative to the project directory containing package.json"
                },
                "temp": {
                    "$ref": "#/definitions/DirectoryPath",
                    "default": "node_modules/.cache/wpbuild/temp",
                    "description": "Path to a temporary directory, full path or relative to the project directory containing package.json"
                },
                "tsconfig": {
                    "type": "string",
                    "default": "tsconfig.json",
                    "pattern": "^(?:(?:\\.[\\\\\\/])?[~@!\\w\\.\\-\\\\\\/]+)?tsconfig[\\-\\.\\w]*?\\.json$",
                    "minLength": 13,
                    "maxLength": 150,
                    "description": "Path to tsconfig file, full path or relative to the project directory containing package.json"
                }
            },
            "additionalProperties": false
        },
        "WpBuildRcPlugins": {
            "type": "object",
            "additionalPropertes": false,
            "properties": {
                "banner": {
                    "type": "boolean",
                    "default": true
                },
                "clean": {
                    "type": "boolean",
                    "default": false
                },
                "copy": {
                    "type": "boolean",
                    "default": false
                },
                "html": {
                    "const": true,
                    "readOnly": true
                },
                "ignore": {
                    "type": "boolean",
                    "default": true
                },
                "istanbul": {
                    "type": "boolean",
                    "default": false
                },
                "licensefiles": {
                    "type": "boolean",
                    "default": true
                },
                "loghooks": {
                    "const": true,
                    "readOnly": true
                },
                "optimization": {
                    "const": true,
                    "readOnly": true
                },
                "progress": {
                    "type": "boolean",
                    "default": false
                },
                "runtimevars": {
                    "type": "boolean",
                    "default": false
                },
                "scm": {
                    "type": "boolean",
                    "default": false
                },
                "sourcemaps": {
                    "type": "boolean",
                    "default": true
                },
                "testsuite": {
                    "type": "boolean",
                    "default": false
                },
                "tscheck": {
                    "type": "boolean",
                    "default": true
                },
                "types": {
                    "type": "boolean",
                    "default": false
                },
                "upload": {
                    "type": "boolean",
                    "default": false
                },
                "vendormod": {
                    "type": "boolean",
                    "default": true
                },
                "wait": {
                    "type": "boolean",
                    "default": false
                }
            }
        },
        "WpBuildLogTrueColor": {
            "type": "string",
            "oneOf": [
                {
                    "const": "black"
                },
                {
                    "const": "blue"
                },
                {
                    "const": "cyan"
                },
                {
                    "const": "green"
                },
                {
                    "const": "grey"
                },
                {
                    "const": "magenta"
                },
                {
                    "const": "red"
                },
                {
                    "const": "white"
                },
                {
                    "const": "yellow"
                }
            ],
            "additionalProperties": false
        },
        "WpBuildLogColor": {
            "type": "string",
            "oneOf": [
                {
                    "const": "black"
                },
                {
                    "const": "blue"
                },
                {
                    "const": "cyan"
                },
                {
                    "const": "green"
                },
                {
                    "const": "grey"
                },
                {
                    "const": "magenta"
                },
                {
                    "const": "red"
                },
                {
                    "const": "system"
                },
                {
                    "const": "white"
                },
                {
                    "const": "yellow"
                },
                {
                    "const": "bold"
                },
                {
                    "const": "inverse"
                },
                {
                    "const": "italic"
                },
                {
                    "const": "underline"
                }
            ],
            "additionalProperties": false
        },
        "WpBuildRcSourceCodeType": {
            "type": "string",
            "default": "typescript",
            "oneOf": [
                {
                    "const": "javascript"
                },
                {
                    "const": "typescript"
                }
            ]
        },
        "WpBuildWebpackEntryObject": {
            "type": "object",
            "properties": {
                "asyncChunks": {
                    "type": "boolean"
                },
                "baseUri": {
                    "type": "string",
                    "minLength": 1
                },
                "chunkLoading": {
                    "oneOf": [
                        {
                            "type": "boolean"
                        },
                        {
                            "type": "string",
                            "oneOf": [
                                {
                                    "const": "jsonp"
                                },
                                {
                                    "const": "import"
                                },
                                {
                                    "const": "importScripts"
                                },
                                {
                                    "const": "require"
                                },
                                {
                                    "const": "async-node"
                                }
                            ],
                            "additionalProperties": false
                        }
                    ],
                    "additionalProperties": false
                },
                "dependOn": {
                    "oneOf": [
                        {
                            "type": "string",
                            "pattern": "^[a-zA-Z][\\w]+$"
                        },
                        {
                            "type": "array",
                            "items": {
                                "type": "string",
                                "pattern": "^[a-zA-Z][\\w]+$"
                            }
                        }
                    ]
                },
                "filename": {
                    "$ref": "#/definitions/FileName"
                },
                "import": {
                    "$ref": "#/definitions/FilePathRelativeLeadingDot"
                },
                "layer": {
                    "type": "string",
                    "oneOf": [
                        {
                            "const": "debug"
                        },
                        {
                            "const": "release"
                        }
                    ],
                    "additionalProperties": false
                },
                "publicPath": {
                    "$ref": "#/definitions/DirectoryPathRelative"
                }
            },
            "propertyNames": {
                "minLength": 3,
                "maxLength": 20,
                "pattern": "^[a-z][\\w]+$"
            },
            "required": [
                "import"
            ]
        },
        "WpBuildWebpackEntryValue": {
            "anyOf": [
                {
                    "$ref": "#/definitions/FilePathRelativeLeadingDot"
                },
                {
                    "$ref": "#/definitions/WpBuildWebpackEntryObject"
                }
            ]
        },
        "WpBuildWebpackEntry": {
            "type": "object",
            "description": "mapping of module names to respective entry point file, relative to context directory",
            "minProperties": 1,
            "patternProperties": {
                "^[a-z][\\w\\-\\.]+$": {
                    "$ref": "#/definitions/WpBuildWebpackEntryValue"
                }
            },
            "propertyNames": {
                "maxLength": 30
            },
            "additionalProperties": false,
            "examples": [
                {
                    "entry": {
                        "modulename": "./path/to/entry.ts"
                    }
                },
                {
                    "entry": {
                        "modulename1": "./path/to/entry1.ts",
                        "modulename2": "./path/to/entry2.ts",
                        "modulename3": "./path/to/entry3.ts"
                    }
                },
                {
                    "entry": {
                        "modulename": {
                            "import": "./path/to/entrymodule.ts"
                        },
                        "modulename2": "./path/to/entry2.ts"
                    }
                },
                {
                    "entry": {
                        "modulename1": {
                            "import": "./path/to/entrymodule1.ts"
                        },
                        "modulename2": {
                            "import": "./path/to/entrymodule1.ts",
                            "dependOn": "modulename1"
                        },
                        "modulename3": {
                            "import": "./path/to/entrymodule2.ts",
                            "dependOn": "modulename2"
                        }
                    }
                }
            ]
        },
        "WpBuildWebpackMode":  {
            "type": "string",
            "default": "production",
            "oneOf": [
                {
                    "const": "development"
                },
                {
                    "const": "production"
                },
                {
                    "const": "none"
                },
                {
                    "const": "test"
                }
            ],
            "additionalProperties": false
        },
        "WpBuildWebpackAliasValue": {
            "anyOf": [
                {
                    "$ref": "#/definitions/DirectoryPathGlob"
                },
                {
                    "type": "array",
                    "items": {
                        "$ref": "#/definitions/DirectoryPathGlob"
                    }
                },
                {
                    "type": "boolean",
                    "const": false,
                    "readOnly": true
                }
            ]
        },
        "WpBuildWebpackAliasConfig": {
            "type": "object",
            "minProperties": 0,
            "patternProperties": {
                "^[a-zA-Z\\:\\@][\\w\\:\\@]+$": {
                    "$ref": "#/definitions/WpBuildWebpackAliasValue"
                }
            },
            "propertyNames": {
                "maxLength": 20
            },
            "description": "Key value pairs for aliased import/require paths",
            "examples": [
                {
                    "alias":
                    {
                        ":env": "src/lib/env/node",
                        ":types": "types"
                    }
                },
                {
                    "alias":
                    {
                        ":env": [
                            "src/lib/env/web", "src/webapp/tools/env/web"
                        ],
                        ":types": "types"
                    }
                }
            ]
        },
        "WebpackConfigOverride": {
            "type": "object",
            "minProperties": 0,
            "patternProperties": {
                "^[a-z][\\w]+$": {
                    "$ref": "#"
                }
            },
            "propertyNames": {
                "maxLength": 20
            },
            "description": "An object that is directly applied to the webpack configurqtion before it is returned to the main process",
            "examples": [
                {
                    "context": "/usr/lib/projectname/src",
                    "resolve":
                        {
                            "alias":
                            {
                                ":env/*": "src/lib/env/node/*",
                                ":types": "types"
                            },
                           "extensions": [ ".ts", ".tsx", ".js", ".jsx", ".json" ]
                        }
                }
            ],
            "additionalProperties": true
        },
        "WebpackTarget":  {
            "type": "string",
            "default": "web",
            "oneOf": [
                {
                    "const": "node"
                },
                {
                    "const": "web"
                },
                {
                    "const": "webworker"
                },
                {
                    "const": "async-node"
                },
                {
                    "const": "node-webkit"
                },
                {
                    "const": "electron-main"
                },
                {
                    "const": "electron-renderer"
                },
                {
                    "const": "electron-preload"
                },
                {
                    "const": "nwjs"
                },
                {
                    "const": "esX"
                },
                {
                    "const": "browserlist"
                }
            ],
            "additionalProperties": false
        },
        "WebpackLibraryType": {
            "type": "string",
            "default": "commonjs2",
            "oneOf": [
                {
                    "const": "var"
                },
                {
                    "const": "module"
                },
                {
                    "const": "assign"
                },
                {
                    "const": "assign-properties"
                },
                {
                    "const": "this"
                },
                {
                    "const": "window"
                },
                {
                    "const": "self"
                },
                {
                    "const": "global"
                },
                {
                    "const": "commonjs"
                },
                {
                    "const": "commonjs2"
                },
                {
                    "const": "commonjs-module"
                },
                {
                    "const": "commonjs-static'"
                },
                {
                    "const": "amd"
                },
                {
                    "const": "amd-require"
                },
                {
                    "const": "umd'"
                },
                {
                    "const": "umd2"
                },
                {
                    "const": "jsonp"
                },
                {
                    "const": "system"
                }
            ]
        }
    }
}